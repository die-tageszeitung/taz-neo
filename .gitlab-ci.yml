image: registry.gitlab.alt.coop/ctrlaltcoop/android-docker:latest

before_script:
  - chmod +x ./gradlew

cache:
  key: ${CI_JOB_NAME}

stages:
  - build
  - test

lint:
  stage: build
  script:
    - ./gradlew -Pci --console=plain :app:lint -PbuildDir=lint

assembleDebug:
  stage: build
  script:
    - ./gradlew assembleDebug
  artifacts:
    paths:
    - app/build/outputs/

unitTests:
  stage: test
  script:
    - ./gradlew -Pci --console=plain :app:test

integrationTests:
  stage: test
  script:
    - ${ANDROID_HOME}/emulator/emulator @test -no-boot-anim -no-window &
    - sleep 30 && ./gradlew -Pci --console=plain :app:cAT

